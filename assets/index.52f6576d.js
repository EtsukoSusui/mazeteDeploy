var ae=Object.defineProperty,re=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var Z=(t,s,i)=>s in t?ae(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,K=(t,s)=>{for(var i in s||(s={}))ne.call(s,i)&&Z(t,i,s[i]);if(Y)for(var i of Y(s))oe.call(s,i)&&Z(t,i,s[i]);return t},U=(t,s)=>re(t,ie(s));import{u as G,a as V,r,v as le,b as v,j as h,c as e,A as ce,T as de,d as he,e as ge,F as ee,B as pe,R as me,f as H,g as fe,h as _e}from"./vendor.744e6562.js";const ve=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))c(d);new MutationObserver(d=>{for(const u of d)if(u.type==="childList")for(const m of u.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&c(m)}).observe(document,{childList:!0,subtree:!0});function i(d){const u={};return d.integrity&&(u.integrity=d.integrity),d.referrerpolicy&&(u.referrerPolicy=d.referrerpolicy),d.crossorigin==="use-credentials"?u.credentials="include":d.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function c(d){if(d.ep)return;d.ep=!0;const u=i(d);fetch(d.href,u)}};ve();const O="https://mazete-api-dev.pechakucha.ai",ye=he({stringify:t=>t.kana+t.label});function Ce(){const[t,s]=r.exports.useState([0,0]);return r.exports.useLayoutEffect(()=>{function i(){s([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",i),i(),()=>window.removeEventListener("resize",i)},[]),t}const Se=["\u30AD\u30E3\u30E9\u540D\u307E\u305F\u306F\u4F5C\u54C1\u540D\u3067\u3055\u304C\u3059","\u5834\u9762\u540D\u307E\u305F\u306F\u4F5C\u54C1\u540D\u3067\u3055\u304C\u3059"];function Ee(){const t=G();V();const[s,i]=r.exports.useState(1),[c,d]=r.exports.useState([]),[u,m]=r.exports.useState(null),[w,T]=r.exports.useState(!1),[E,k]=r.exports.useState([]),[D,I]=r.exports.useState([]),[N,L]=r.exports.useState([]),[g,f]=r.exports.useState([]),[A,S]=r.exports.useState([]),[x,F]=r.exports.useState(null),[J,j]=Ce();r.exports.useEffect(()=>{let o=window.innerHeight;document.getElementById("character_select").style.height=o+"px";let a=sessionStorage.register_id||null,n=sessionStorage.background||null,l=sessionStorage.user_list||null;if(l&&d(JSON.parse(l)),n&&m(JSON.parse(n)),!a){a=le();var B=JSON.stringify({register_id:a}),_={method:"post",url:`${O}/register_id`,headers:{"Content-Type":"application/json"},data:B};v(_).then(p=>{sessionStorage.setItem("register_id",a)}).catch(p=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}let y=JSON.stringify({user_id:a,search_query:"",chosen_chara_ids:"",chosen_world_ids:""}),C={method:"post",url:`${O}/get_chara_list`,headers:{"Content-Type":"application/json"},data:y};v(C).then(p=>{k(p.data.chara_list)}).catch(p=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})});let R=JSON.stringify({user_id:a,search_query:"",chosen_chara_ids:"",chosen_world_ids:""}),z={method:"post",url:`${O}/get_world_list`,headers:{"Content-Type":"application/json"},data:R};v(z).then(p=>{I(p.data.world_list)}).catch(p=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})});let $={method:"post",url:`${O}/get_autocomplete_chara`,headers:{"Content-Type":"application/json"},data:{}};v($).then(p=>{f(p.data.auto_complete),S(p.data.auto_complete)}).catch(p=>{});let M={method:"post",url:`${O}/get_autocomplete_world`,headers:{"Content-Type":"application/json"},data:{}};v(M).then(p=>{L(p.data.auto_complete)}).catch(p=>{})},[]),r.exports.useEffect(()=>{u&&c.length>0?T(!0):T(!1)},[c,u]);const b=o=>{let a=c,n=E.filter(l=>l.chara_id==o)[0];if(a==null?void 0:a.map(l=>l.chara_id).includes(o)){for(let l=0;l<a.length;l++)a[l].chara_id===o&&(a.splice(l,1),l--);d([...a])}else a.length<3&&(a.push(n),d([...a]))},W=()=>{let o=sessionStorage.register_id||null,a=JSON.stringify({user_id:o,chosen_chara_ids:c.map(l=>l.chara_id).toString(),chosen_world_ids:[u.world_id].toString()}),n={method:"post",url:`${O}/generate_outline`,headers:{"Content-Type":"application/json"},data:a};v(n).then(l=>{sessionStorage.setItem("outline_id",l.data.outline_id),sessionStorage.setItem("background",JSON.stringify(u)),sessionStorage.setItem("user_list",JSON.stringify(c)),sessionStorage.removeItem("outline_data"),t("/synopsis",{state:{}})}).catch(l=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})},P=o=>{o.preventDefault();let a=sessionStorage.register_id||null,n=x,l=c.map(y=>y.chara_id).toString(),B="";u&&(B=[u.world_id].toString());let _=JSON.stringify({user_id:a,search_query:n,chosen_chara_ids:l,chosen_world_ids:B});if(s==1){let y={method:"post",url:`${O}/get_chara_list`,headers:{"Content-Type":"application/json"},data:_};v(y).then(C=>{k(C.data.chara_list)}).catch(C=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}else{let y={method:"post",url:`${O}/get_world_list`,headers:{"Content-Type":"application/json"},data:_};v(y).then(C=>{I(C.data.world_list)}).catch(C=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}},q=o=>a=>{a.stopPropagation();let n=c;for(let l=0;l<n.length;l++)n[l].chara_id===o&&(n.splice(l,1),l--);d([...n])};return h("div",{className:"container",id:"character_select",children:[h("div",{className:"container-wrap",children:[h("div",{className:"common-header",children:[e("div",{className:"common-header-title01",children:"-\u4F5C\u54C1\u30EA\u30DF\u30C3\u30AF\u30B9-"}),e("div",{className:"common-header-title02",children:"\u30DE\u305C\u3066"})]}),h("div",{className:"preview",children:[h("div",{className:"preview-part",onClick:()=>{i(1),S(g),F(null)},children:[h("div",{className:"preview-img-part",children:[c==null?void 0:c.map(o=>e("div",{style:{backgroundImage:`url(${o.img_url})`},className:"avatar-preview",children:h("div",{className:"avatar-preview-close",onClick:q(o.chara_id),children:[e("span",{}),e("span",{})]})},o.chara_id)),c.length==0&&e("div",{className:"avatar-preview",style:{backgroundImage:"url(/assets/image/default-avatar.png)"}})]}),e("div",{className:s===1?"preview-title-part active":"preview-title-part",children:"\u30AD\u30E3\u30E9"})]}),h("div",{className:"preview-part",onClick:()=>{i(2),S(N),F(null)},children:[e("div",{className:"preview-img-part",children:e("div",{style:{backgroundImage:`url(${u!=null?u.img_url:"/assets/image/point-bg.png"})`},className:u!=null?"world-preview":"world-none-preview"})}),e("div",{className:s===2?"preview-title-part active":"preview-title-part",children:"\u30B7\u30C1\u30E5\u30A8\u30FC\u30B7\u30E7\u30F3"})]})]}),h("div",{className:"point-select",children:[e("div",{className:"point-search",children:h("form",{onSubmit:P,children:[e(ce,{value:x,onChange:(o,a)=>{typeof a=="string"?F({label:a}):a&&a.inputValue?F({label:a.inputValue}):F(a)},filterOptions:(o,a)=>ye(o,a),selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:A,getOptionLabel:o=>typeof o=="string"?o:o.label,renderOption:(o,a)=>e("li",U(K({},o),{children:a.label})),renderInput:o=>e(de,U(K({},o),{label:"",placeholder:Se[s-1]}))}),e("button",{className:"search-btn",children:e("img",{src:"/assets/image/point-search.png",alt:""})})]})}),e("div",{className:"point-intro",children:"\u753B\u50CF\u306FBing\u306E\u691C\u7D22\u7D50\u679C\u3092\u3082\u3068\u306B\u8868\u793A\u3057\u3066\u3044\u307E\u3059"}),h("div",{className:"point-body",style:{height:`calc(${j}px - 305px)`},children:[s===1&&e("div",{className:"point-body-wrap",children:E==null?void 0:E.map((o,a)=>e("div",{style:{backgroundImage:`url(${o.img_url})`},onClick:()=>b(o.chara_id),className:`${c.map(n=>n.chara_id).includes(o.chara_id)?"active":""} character-item`,children:e("span",{})},a))}),s==2&&e("div",{className:"point-body-wrap",children:D==null?void 0:D.map((o,a)=>e("div",{style:{backgroundImage:`url(${o.img_url})`},className:`${(u==null?void 0:u.img_url)==o.img_url?"active":""} location-item`,onClick:n=>{m(o)},children:e("span",{})},a))})]})]})]}),h("button",{onClick:W,className:`character-add-btn ${w?"active":""}`,disabled:!w,children:[e("img",{src:"/assets/image/imgpsh_fullsize_anim.png",alt:""}),"\u30DE\u305C\u308B"]})]})}const te="https://mazete-api-dev.pechakucha.ai";function Fe(){const[t,s]=r.exports.useState([0,0]);return r.exports.useLayoutEffect(()=>{function i(){s([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",i),i(),()=>window.removeEventListener("resize",i)},[]),t}function be(){const t=G(),s=r.exports.useRef(),[i,c]=r.exports.useState(!1),[d,u]=r.exports.useState(!0),[m,w]=r.exports.useState(""),[T,E]=r.exports.useState([]),[k,D]=r.exports.useState(null),[I,N]=r.exports.useState(10);Fe(),r.exports.useEffect(()=>{var f;let g=((f=s==null?void 0:s.current)==null?void 0:f.scrollHeight)+"px";N(g)},[m]),r.exports.useEffect(()=>{let g=window.innerHeight;document.getElementById("loading_synposis").style.height=g+"px";let f=sessionStorage.register_id||null,A=sessionStorage.outline_id||null,S=sessionStorage.background||null,x=sessionStorage.user_list||null,F=sessionStorage.outline_data||null;(!x||!S)&&t("/",{state:{}}),D(JSON.parse(S)),E(JSON.parse(x));let J=JSON.stringify({user_id:f,outline_id:A});if(F)w(JSON.parse(F)),u(!1);else{let j={method:"post",url:`${te}/get_outline`,headers:{"Content-Type":"application/json"},data:J};v(j).then(b=>{b.data.generated&&b.data.outline&&!b.data.error?(u(!1),w(b.data.outline)):t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}).catch(b=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}},[]);const L=()=>{let g=sessionStorage.register_id||null,f=sessionStorage.outline_id||null;sessionStorage.setItem("outline_data",JSON.stringify(m));let A=JSON.stringify({user_id:g,outline_id:f,outline:m}),S={method:"post",url:`${te}/generate_story`,headers:{"Content-Type":"application/json"},data:A};v(S).then(x=>{t(`/talk/${x.data.story_id}`,{state:{}})}).catch(x=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})};return r.exports.useEffect(()=>{s.current&&i&&s.current.focus()},[i]),h("div",{className:"container",id:"loading_synposis",children:[h("div",{className:"container-wrap",children:[e("div",{className:`ls-top ${i?"editing":""}`,children:e("div",{className:"ls-top-wrap",style:{backgroundImage:`url(${k==null?void 0:k.img_url}`,backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center"},children:e("div",{className:"ls-top-body",children:T.map((g,f)=>e("div",{className:"ls-top-item",style:{backgroundImage:`url(${g==null?void 0:g.img_url})`}},f))})})}),h("div",{className:"ls-main",children:[e("div",{className:"ls-main-title",children:"\u307E\u3048\u304C\u304D"}),h("div",{className:"ls-main-loading-text",children:[d&&h("div",{className:"ls-main-loading-part",children:[e("img",{src:"/assets/image/white-loading.gif",alt:""}),e("span",{children:"\u4E0B\u66F8\u304D\u6E96\u5099\u4E2D"})]}),!d&&e("textarea",{style:{height:I},ref:s,className:"ls-main-loading-wrap",value:m,disabled:!i,onChange:g=>{w(g.target.value)},onBlur:()=>{c(!1)}})]}),!i&&h("a",{className:"ls-main-edit-btn",onClick:()=>{s.current.focus(),c(!0)},children:[e("span",{children:"\u7DE8\u96C6"}),e("img",{src:"/assets/image/edit-icon.png",alt:""})]}),!i&&e("div",{className:"ls-main-making-btn-part",children:e("button",{onClick:L,className:d?"ls-main-making-btn":"ls-main-making-btn active",disabled:d,children:"\u3053\u306E\u4E16\u754C\u7DDA\u306B\u5165\u308B"})})]})]}),!i&&e("button",{className:"back-to-btn",onClick:()=>{let g=sessionStorage.user_list||null;t("/",{state:{user_list:g}})},children:e("img",{src:"/assets/image/back-to-img.png",alt:""})})]})}const Q="https://mazete-api-dev.pechakucha.ai";function ue(t){return new Promise(s=>setTimeout(s,t))}function we(){const[t,s]=r.exports.useState([0,0]);return r.exports.useLayoutEffect(()=>{function i(){s([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",i),i(),()=>window.removeEventListener("resize",i)},[]),t}function Ne(){const t=G(),[s,i]=r.exports.useState(!0),[c,d]=r.exports.useState(null),[u,m]=r.exports.useState(0),[w,T]=r.exports.useState(null),[E,k]=r.exports.useState(null),[D,I]=r.exports.useState([]),[N,L]=r.exports.useState(!1),[g,f]=r.exports.useState(!1),[A,S]=r.exports.useState(!1),[x,F]=we();let{story_id:J}=ge();r.exports.useEffect(()=>{let n=sessionStorage.register_id||null,l=JSON.stringify({user_id:n,story_id:J}),B={method:"post",url:`${Q}/get_story`,headers:{"Content-Type":"application/json"},data:l};v(B).then(_=>{if(_.data.generated&&!_.data.error){d(_.data);var y=_.data.story.length,C=0;_.data.story.forEach(R=>{var z=new Image;z.onload=function(){C++,y==C&&i(!1)},z.src=R.chara_img_url})}else t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}).catch(_=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})},[]),r.exports.useEffect(()=>{c&&j()},[c,u]),r.exports.useEffect(async()=>{if(c){let n=c.story;await ue(1),T(n[u].position)}},[E]);const j=()=>{let n=c.story;k(n[u].chara_img_url),n[u].multiple?(L(!0),I(n[u].content)):(L(!1),b(n[u].content))},b=async n=>{S(!0);for(var l=0;l<n.length;)I([n.substring(0,l+1)]),l++,await ue(75);S(!1),c.story.length-1==u&&f(!0)},W=n=>{N&&(L(!1),b(n))},P=()=>{!A&&!N&&c.story.length-1>u&&m(u+1)},q=()=>{u===0&&t("/synopsis",{state:{}}),u!=0&&!A&&(m(u-1),f(!1))},o=n=>{n.preventDefault(),sessionStorage.removeItem("outline_id"),sessionStorage.removeItem("background"),sessionStorage.removeItem("user_list"),t("/",{state:{}})},a=n=>{if(!N)return;let l=sessionStorage.register_id||null;i(!0);let B=JSON.stringify({user_id:l,story_id:J,chosen_content:n}),_={method:"post",url:`${Q}/generate_rest_story`,headers:{"Content-Type":"application/json"},data:B};v(_).then(y=>{let C=y.data.story_id,R=JSON.stringify({user_id:l,story_id:C}),z={method:"post",url:`${Q}/get_rest_story`,headers:{"Content-Type":"application/json"},data:R};v(z).then($=>{if($.data.generated&&!$.data.error){c.story.splice(u+1,c.story.length-u-1),c.story=c.story.concat($.data.story),d(c),W(n);var M=$.data.story.length,p=0;$.data.story.forEach(se=>{var X=new Image;X.onload=function(){p++,M==p&&i(!1)},X.src=se.chara_img_url})}else t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}).catch($=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}).catch(y=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})};return h(ee,{children:[s&&e("div",{className:"container",id:"loading_adventure",children:e("div",{className:"container-wrap",children:h("div",{className:"la-wrap",children:[e("img",{src:"/assets/image/black-loading.gif",alt:""}),e("span",{children:"\u6E96\u5099\u4E2D"})]})})}),!s&&h("div",{className:"container",id:"adventure_state",style:{height:F},children:[h("div",{className:"container-wrap",onClick:P,children:[e("div",{className:"as-thumb",style:{backgroundImage:`url(${c==null?void 0:c.background_url})`},children:E&&e("img",{src:E,alt:"",className:`as-thumb-character ${w==0?"lb":w==1?"mb":"rb"}`})}),e("div",{className:"as-text",children:D.map((n,l)=>e("div",{className:`as-text-wrap ${A||N||g?"":"arrow"}`,style:{minHeight:`${N?"unset":"80px"}`},onClick:()=>{a(n)},children:n},l))})]}),e("button",{className:"back-to-btn",onClick:q,children:e("img",{src:u==0?"/assets/image/back-to-img.png":"/assets/image/back.png",alt:""})}),g&&e("div",{className:"text-select-btn-group",children:e("a",{onClick:o,className:"final-btn",children:"\u30C8\u30C3\u30D7\u3078"})})]})]})}function Ae(){const t=V();return console.log(t),e("div",{className:"flex-center position-ref full-height full-width bg-white",children:e("div",{className:"message",style:{padding:"10px"},dangerouslySetInnerHTML:{__html:t.state.message}})})}function xe(){return e(pe,{children:h(me,{children:[e(H,{path:"/",element:e(Ee,{})}),e(H,{path:"/synopsis",element:e(be,{})}),e(H,{path:"/talk/:id",element:e(Ne,{})}),e(H,{path:"/error",element:e(Ae,{})})]})})}function ke(){return e(ee,{children:e(xe,{})})}fe.render(e(_e.StrictMode,{children:e(ke,{})}),document.getElementById("root"));
