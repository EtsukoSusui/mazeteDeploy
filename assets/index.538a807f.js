var se=Object.defineProperty,ue=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var X=(t,u,a)=>u in t?se(t,u,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[u]=a,M=(t,u)=>{for(var a in u||(u={}))re.call(u,a)&&X(t,a,u[a]);if(Q)for(var a of Q(u))ie.call(u,a)&&X(t,a,u[a]);return t},K=(t,u)=>ue(t,ae(u));import{u as U,a as Y,r as i,v as ne,b as _,j as h,c as e,A as oe,T as le,d as ce,e as de,F as Z,B as he,R as pe,f as j,g as ge,h as me}from"./vendor.744e6562.js";const fe=function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))o(d);new MutationObserver(d=>{for(const s of d)if(s.type==="childList")for(const g of s.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&o(g)}).observe(document,{childList:!0,subtree:!0});function a(d){const s={};return d.integrity&&(s.integrity=d.integrity),d.referrerpolicy&&(s.referrerPolicy=d.referrerpolicy),d.crossorigin==="use-credentials"?s.credentials="include":d.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(d){if(d.ep)return;d.ep=!0;const s=a(d);fetch(d.href,s)}};fe();const $="https://mazete-api-dev.pechakucha.ai",_e=ce({stringify:t=>t.kana+t.label});function ve(){const[t,u]=i.exports.useState([0,0]);return i.exports.useLayoutEffect(()=>{function a(){u([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",a),a(),()=>window.removeEventListener("resize",a)},[]),t}const ye=["\u30AD\u30E3\u30E9\u540D\u307E\u305F\u306F\u4F5C\u54C1\u540D\u3067\u3055\u304C\u3059","\u5834\u9762\u540D\u307E\u305F\u306F\u4F5C\u54C1\u540D\u3067\u3055\u304C\u3059"];function Ce(){const t=U();Y();const[u,a]=i.exports.useState(1),[o,d]=i.exports.useState([]),[s,g]=i.exports.useState(null),[b,T]=i.exports.useState(!1),[C,x]=i.exports.useState([]),[O,D]=i.exports.useState([]),[k,L]=i.exports.useState([]),[p,f]=i.exports.useState([]),[w,v]=i.exports.useState([]),[N,S]=i.exports.useState(null),[z,J]=ve();i.exports.useEffect(()=>{let l=window.innerHeight;document.getElementById("character_select").style.height=l+"px";let r=sessionStorage.register_id||null,n=sessionStorage.background||null,c=sessionStorage.user_list||null;if(c&&d(JSON.parse(c)),n&&g(JSON.parse(n)),!r){r=ne();var B=JSON.stringify({register_id:r}),y={method:"post",url:`${$}/register_id`,headers:{"Content-Type":"application/json"},data:B};_(y).then(m=>{sessionStorage.setItem("register_id",r)}).catch(m=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}let E=JSON.stringify({user_id:r,search_query:"",chosen_chara_ids:"",chosen_world_ids:""}),A={method:"post",url:`${$}/get_chara_list`,headers:{"Content-Type":"application/json"},data:E};_(A).then(m=>{x(m.data.chara_list)}).catch(m=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})});let P=JSON.stringify({user_id:r,search_query:"",chosen_chara_ids:"",chosen_world_ids:""}),q={method:"post",url:`${$}/get_world_list`,headers:{"Content-Type":"application/json"},data:P};_(q).then(m=>{D(m.data.world_list)}).catch(m=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})});let I={method:"post",url:`${$}/get_autocomplete_chara`,headers:{"Content-Type":"application/json"},data:{}};_(I).then(m=>{f(m.data.auto_complete),v(m.data.auto_complete)}).catch(m=>{});let te={method:"post",url:`${$}/get_autocomplete_world`,headers:{"Content-Type":"application/json"},data:{}};_(te).then(m=>{L(m.data.auto_complete)}).catch(m=>{})},[]),i.exports.useEffect(()=>{s&&o.length>0?T(!0):T(!1)},[o,s]);const F=l=>{let r=o,n=C.filter(c=>c.chara_id==l)[0];if(r==null?void 0:r.map(c=>c.chara_id).includes(l)){for(let c=0;c<r.length;c++)r[c].chara_id===l&&(r.splice(c,1),c--);d([...r])}else r.length<3&&(r.push(n),d([...r]))},R=()=>{let l=sessionStorage.register_id||null,r=JSON.stringify({user_id:l,chosen_chara_ids:o.map(c=>c.chara_id).toString(),chosen_world_ids:[s.world_id].toString()}),n={method:"post",url:`${$}/generate_outline`,headers:{"Content-Type":"application/json"},data:r};_(n).then(c=>{sessionStorage.setItem("outline_id",c.data.outline_id),sessionStorage.setItem("background",JSON.stringify(s)),sessionStorage.setItem("user_list",JSON.stringify(o)),sessionStorage.removeItem("outline_data"),t("/synopsis",{state:{}})}).catch(c=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})},H=l=>{l.preventDefault();let r=sessionStorage.register_id||null,n=N,c=o.map(E=>E.chara_id).toString(),B="";s&&(B=[s.world_id].toString());let y=JSON.stringify({user_id:r,search_query:n,chosen_chara_ids:c,chosen_world_ids:B});if(u==1){let E={method:"post",url:`${$}/get_chara_list`,headers:{"Content-Type":"application/json"},data:y};_(E).then(A=>{x(A.data.chara_list)}).catch(A=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}else{let E={method:"post",url:`${$}/get_world_list`,headers:{"Content-Type":"application/json"},data:y};_(E).then(A=>{D(A.data.world_list)}).catch(A=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}},W=l=>r=>{r.stopPropagation();let n=o;for(let c=0;c<n.length;c++)n[c].chara_id===l&&(n.splice(c,1),c--);d([...n])};return h("div",{className:"container",id:"character_select",children:[h("div",{className:"container-wrap",children:[h("div",{className:"common-header",children:[e("div",{className:"common-header-title01",children:"-\u4F5C\u54C1\u30EA\u30DF\u30C3\u30AF\u30B9-"}),e("div",{className:"common-header-title02",children:"\u30DE\u305C\u3066"})]}),h("div",{className:"preview",children:[h("div",{className:"preview-part",onClick:()=>{a(1),v(p),S(null)},children:[h("div",{className:"preview-img-part",children:[o==null?void 0:o.map(l=>e("div",{style:{backgroundImage:`url(${l.img_url})`},className:"avatar-preview",children:h("div",{className:"avatar-preview-close",onClick:W(l.chara_id),children:[e("span",{}),e("span",{})]})},l.chara_id)),o.length==0&&e("div",{className:"avatar-preview",style:{backgroundImage:"url(/assets/image/default-avatar.png)"}})]}),e("div",{className:u===1?"preview-title-part active":"preview-title-part",children:"\u30AD\u30E3\u30E9"})]}),h("div",{className:"preview-part",onClick:()=>{a(2),v(k),S(null)},children:[e("div",{className:"preview-img-part",children:e("div",{style:{backgroundImage:`url(${s!=null?s.img_url:"/assets/image/point-bg.png"})`},className:s!=null?"world-preview":"world-none-preview"})}),e("div",{className:u===2?"preview-title-part active":"preview-title-part",children:"\u30B7\u30C1\u30E5\u30A8\u30FC\u30B7\u30E7\u30F3"})]})]}),h("div",{className:"point-select",children:[e("div",{className:"point-search",children:h("form",{onSubmit:H,children:[e(oe,{value:N,onChange:(l,r)=>{typeof r=="string"?S({label:r}):r&&r.inputValue?S({label:r.inputValue}):S(r)},filterOptions:(l,r)=>_e(l,r),selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:w,getOptionLabel:l=>typeof l=="string"?l:l.label,renderOption:(l,r)=>e("li",K(M({},l),{children:r.label})),renderInput:l=>e(le,K(M({},l),{label:"",placeholder:ye[u-1]}))}),e("button",{className:"search-btn",children:e("img",{src:"/assets/image/point-search.png",alt:""})})]})}),e("div",{className:"point-intro",children:"\u753B\u50CF\u306FBing\u306E\u691C\u7D22\u7D50\u679C\u3092\u3082\u3068\u306B\u8868\u793A\u3057\u3066\u3044\u307E\u3059"}),h("div",{className:"point-body",style:{height:`calc(${J}px - 305px)`},children:[u===1&&e("div",{className:"point-body-wrap",children:C==null?void 0:C.map((l,r)=>e("div",{style:{backgroundImage:`url(${l.img_url})`},onClick:()=>F(l.chara_id),className:`${o.map(n=>n.chara_id).includes(l.chara_id)?"active":""} character-item`,children:e("span",{})},r))}),u==2&&e("div",{className:"point-body-wrap",children:O==null?void 0:O.map((l,r)=>e("div",{style:{backgroundImage:`url(${l.img_url})`},className:`${(s==null?void 0:s.img_url)==l.img_url?"active":""} location-item`,onClick:n=>{g(l)},children:e("span",{})},r))})]})]})]}),h("button",{onClick:R,className:`character-add-btn ${b?"active":""}`,disabled:!b,children:[e("img",{src:"/assets/image/imgpsh_fullsize_anim.png",alt:""}),"\u30DE\u305C\u308B"]})]})}const V="https://mazete-api-dev.pechakucha.ai";function Se(){const[t,u]=i.exports.useState([0,0]);return i.exports.useLayoutEffect(()=>{function a(){u([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",a),a(),()=>window.removeEventListener("resize",a)},[]),t}function Fe(){const t=U(),u=i.exports.useRef(),[a,o]=i.exports.useState(!1),[d,s]=i.exports.useState(!0),[g,b]=i.exports.useState(""),[T,C]=i.exports.useState([]),[x,O]=i.exports.useState(null),[D,k]=i.exports.useState(10);Se(),i.exports.useEffect(()=>{var f;let p=((f=u==null?void 0:u.current)==null?void 0:f.scrollHeight)+"px";k(p)},[g]),i.exports.useEffect(()=>{let p=window.innerHeight;document.getElementById("loading_synposis").style.height=p+"px";let f=sessionStorage.register_id||null,w=sessionStorage.outline_id||null,v=sessionStorage.background||null,N=sessionStorage.user_list||null,S=sessionStorage.outline_data||null;(!N||!v)&&t("/",{state:{}}),O(JSON.parse(v)),C(JSON.parse(N));let z=JSON.stringify({user_id:f,outline_id:w});if(S)b(JSON.parse(S)),s(!1);else{let J={method:"post",url:`${V}/get_outline`,headers:{"Content-Type":"application/json"},data:z};_(J).then(F=>{F.data.generated&&F.data.outline&&!F.data.error?(s(!1),b(F.data.outline)):t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}).catch(F=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}},[]);const L=()=>{let p=sessionStorage.register_id||null,f=sessionStorage.outline_id||null;sessionStorage.setItem("outline_data",JSON.stringify(g));let w=JSON.stringify({user_id:p,outline_id:f,outline:g}),v={method:"post",url:`${V}/generate_story`,headers:{"Content-Type":"application/json"},data:w};_(v).then(N=>{t(`/talk/${N.data.story_id}`,{state:{}})}).catch(N=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})};return i.exports.useEffect(()=>{u.current&&a&&u.current.focus()},[a]),h("div",{className:"container",id:"loading_synposis",children:[h("div",{className:"container-wrap",children:[e("div",{className:`ls-top ${a?"editing":""}`,children:e("div",{className:"ls-top-wrap",style:{backgroundImage:`url(${x==null?void 0:x.img_url}`,backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center"},children:e("div",{className:"ls-top-body",children:T.map((p,f)=>e("div",{className:"ls-top-item",style:{backgroundImage:`url(${p==null?void 0:p.img_url})`}},f))})})}),h("div",{className:"ls-main",children:[e("div",{className:"ls-main-title",children:"\u307E\u3048\u304C\u304D"}),h("div",{className:"ls-main-loading-text",children:[d&&h("div",{className:"ls-main-loading-part",children:[e("img",{src:"/assets/image/white-loading.gif",alt:""}),e("span",{children:"\u4E0B\u66F8\u304D\u6E96\u5099\u4E2D"})]}),!d&&e("textarea",{style:{height:D},ref:u,className:"ls-main-loading-wrap",value:g,disabled:!a,onChange:p=>{b(p.target.value)},onBlur:()=>{o(!1)}})]}),!a&&h("a",{className:"ls-main-edit-btn",onClick:()=>{u.current.focus(),o(!0)},children:[e("span",{children:"\u7DE8\u96C6"}),e("img",{src:"/assets/image/edit-icon.png",alt:""})]}),!a&&e("div",{className:"ls-main-making-btn-part",children:e("button",{onClick:L,className:d?"ls-main-making-btn":"ls-main-making-btn active",disabled:d,children:"\u3053\u306E\u4E16\u754C\u7DDA\u306B\u5165\u308B"})})]})]}),!a&&e("button",{className:"back-to-btn",onClick:()=>{let p=sessionStorage.user_list||null;t("/",{state:{user_list:p}})},children:e("img",{src:"/assets/image/back-to-img.png",alt:""})})]})}const G="https://mazete-api-dev.pechakucha.ai";function ee(t){return new Promise(u=>setTimeout(u,t))}function Ee(){const[t,u]=i.exports.useState([0,0]);return i.exports.useLayoutEffect(()=>{function a(){u([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",a),a(),()=>window.removeEventListener("resize",a)},[]),t}function be(){const t=U(),[u,a]=i.exports.useState(!0),[o,d]=i.exports.useState(null),[s,g]=i.exports.useState(0),[b,T]=i.exports.useState(null),[C,x]=i.exports.useState(null),[O,D]=i.exports.useState([]),[k,L]=i.exports.useState(!1),[p,f]=i.exports.useState(!1),[w,v]=i.exports.useState(!1),[N,S]=Ee();let{story_id:z}=de();i.exports.useEffect(()=>{let n=sessionStorage.register_id||null,c=JSON.stringify({user_id:n,story_id:z}),B={method:"post",url:`${G}/get_story`,headers:{"Content-Type":"application/json"},data:c};_(B).then(y=>{a(!1),y.data.generated&&!y.data.error?(a(!1),d(y.data)):t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}).catch(y=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})},[]),i.exports.useEffect(()=>{o&&J()},[o,s]),i.exports.useEffect(async()=>{if(o){let n=o.story;await ee(1),T(n[s].position)}},[C]);const J=()=>{let n=o.story;x(n[s].chara_img_url),n[s].multiple?(L(!0),D(n[s].content)):(L(!1),F(n[s].content))},F=async n=>{v(!0);for(var c=0;c<n.length;)D([n.substring(0,c+1)]),c++,await ee(75);v(!1),o.story.length-1==s&&f(!0)},R=n=>{k&&(L(!1),F(n))},H=()=>{!w&&!k&&o.story.length-1>s&&g(s+1)},W=()=>{s===0&&t("/synopsis",{state:{}}),s!=0&&!w&&(g(s-1),f(!1))},l=n=>{n.preventDefault(),sessionStorage.removeItem("outline_id"),sessionStorage.removeItem("background"),sessionStorage.removeItem("user_list"),t("/",{state:{}})},r=n=>{let c=sessionStorage.register_id||null;a(!0);let B=JSON.stringify({user_id:c,story_id:z,chosen_content:n}),y={method:"post",url:`${G}/generate_rest_story`,headers:{"Content-Type":"application/json"},data:B};_(y).then(E=>{let A=E.data.story_id,P=JSON.stringify({user_id:c,story_id:A}),q={method:"post",url:`${G}/get_rest_story`,headers:{"Content-Type":"application/json"},data:P};_(q).then(I=>{a(!1),I.data.generated&&!I.data.error?(console.log(o.story,s,o.story.length),o.story.splice(s+1,o.story.length-s-1),o.story=o.story.concat(I.data.story),d(o),R(n)):t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}).catch(I=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}).catch(E=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})};return h(Z,{children:[u&&e("div",{className:"container",id:"loading_adventure",children:e("div",{className:"container-wrap",children:h("div",{className:"la-wrap",children:[e("img",{src:"/assets/image/black-loading.gif",alt:""}),e("span",{children:"\u6E96\u5099\u4E2D"})]})})}),!u&&h("div",{className:"container",id:"adventure_state",style:{height:S},children:[h("div",{className:"container-wrap",onClick:H,children:[e("div",{className:"as-thumb",style:{backgroundImage:`url(${o==null?void 0:o.background_url})`},children:C&&e("img",{src:C,alt:"",className:`as-thumb-character ${b==0?"lb":b==1?"mb":"rb"}`})}),e("div",{className:"as-text",children:O.map((n,c)=>e("div",{className:`as-text-wrap ${w||k||p?"":"arrow"}`,style:{minHeight:`${k?"unset":"80px"}`},onClick:()=>{r(n)},children:n},c))})]}),e("button",{className:"back-to-btn",onClick:W,children:e("img",{src:s==0?"/assets/image/back-to-img.png":"/assets/image/back.png",alt:""})}),p&&e("div",{className:"text-select-btn-group",children:e("a",{onClick:l,className:"final-btn",children:"\u30C8\u30C3\u30D7\u3078"})})]})]})}function we(){const t=Y();return console.log(t),e("div",{className:"flex-center position-ref full-height full-width bg-white",children:e("div",{className:"message",style:{padding:"10px"},dangerouslySetInnerHTML:{__html:t.state.message}})})}function Ne(){return e(he,{children:h(pe,{children:[e(j,{path:"/",element:e(Ce,{})}),e(j,{path:"/synopsis",element:e(Fe,{})}),e(j,{path:"/talk/:id",element:e(be,{})}),e(j,{path:"/error",element:e(we,{})})]})})}function Ae(){return e(Z,{children:e(Ne,{})})}ge.render(e(me.StrictMode,{children:e(Ae,{})}),document.getElementById("root"));
