var se=Object.defineProperty,ue=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var X=(t,a,u)=>a in t?se(t,a,{enumerable:!0,configurable:!0,writable:!0,value:u}):t[a]=u,M=(t,a)=>{for(var u in a||(a={}))re.call(a,u)&&X(t,u,a[u]);if(Q)for(var u of Q(a))ie.call(a,u)&&X(t,u,a[u]);return t},K=(t,a)=>ue(t,ae(a));import{u as U,a as Y,r as n,v as ne,b as f,j as h,c as e,A as oe,T as le,d as ce,e as de,F as Z,B as he,R as pe,f as j,g as ge,h as me}from"./vendor.744e6562.js";const fe=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))c(d);new MutationObserver(d=>{for(const s of d)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&c(m)}).observe(document,{childList:!0,subtree:!0});function u(d){const s={};return d.integrity&&(s.integrity=d.integrity),d.referrerpolicy&&(s.referrerPolicy=d.referrerpolicy),d.crossorigin==="use-credentials"?s.credentials="include":d.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(d){if(d.ep)return;d.ep=!0;const s=u(d);fetch(d.href,s)}};fe();const $="https://mazete-api-dev.pechakucha.ai",_e=ce({stringify:t=>t.kana+t.label});function ve(){const[t,a]=n.exports.useState([0,0]);return n.exports.useLayoutEffect(()=>{function u(){a([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",u),u(),()=>window.removeEventListener("resize",u)},[]),t}const ye=["\u30AD\u30E3\u30E9\u540D\u307E\u305F\u306F\u4F5C\u54C1\u540D\u3067\u3055\u304C\u3059","\u5834\u9762\u540D\u307E\u305F\u306F\u4F5C\u54C1\u540D\u3067\u3055\u304C\u3059"];function Ce(){const t=U();Y();const[a,u]=n.exports.useState(1),[c,d]=n.exports.useState([]),[s,m]=n.exports.useState(null),[b,O]=n.exports.useState(!1),[N,x]=n.exports.useState([]),[I,T]=n.exports.useState([]),[k,L]=n.exports.useState([]),[p,y]=n.exports.useState([]),[E,_]=n.exports.useState([]),[w,C]=n.exports.useState(null),[z,J]=ve();n.exports.useEffect(()=>{let o=window.innerHeight;document.getElementById("character_select").style.height=o+"px";let i=sessionStorage.register_id||null,r=sessionStorage.background||null,l=sessionStorage.user_list||null;if(l&&d(JSON.parse(l)),r&&m(JSON.parse(r)),!i){i=ne();var B=JSON.stringify({register_id:i}),v={method:"post",url:`${$}/register_id`,headers:{"Content-Type":"application/json"},data:B};f(v).then(g=>{sessionStorage.setItem("register_id",i)}).catch(g=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}let F=JSON.stringify({user_id:i,search_query:"",chosen_chara_ids:"",chosen_world_ids:""}),A={method:"post",url:`${$}/get_chara_list`,headers:{"Content-Type":"application/json"},data:F};f(A).then(g=>{x(g.data.chara_list)}).catch(g=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})});let P=JSON.stringify({user_id:i,search_query:"",chosen_chara_ids:"",chosen_world_ids:""}),q={method:"post",url:`${$}/get_world_list`,headers:{"Content-Type":"application/json"},data:P};f(q).then(g=>{T(g.data.world_list)}).catch(g=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})});let D={method:"post",url:`${$}/get_autocomplete_chara`,headers:{"Content-Type":"application/json"},data:{}};f(D).then(g=>{y(g.data.auto_complete),_(g.data.auto_complete)}).catch(g=>{});let te={method:"post",url:`${$}/get_autocomplete_world`,headers:{"Content-Type":"application/json"},data:{}};f(te).then(g=>{L(g.data.auto_complete)}).catch(g=>{})},[]),n.exports.useEffect(()=>{s&&c.length>0?O(!0):O(!1)},[c,s]);const S=o=>{let i=c,r=N.filter(l=>l.chara_id==o)[0];if(i.map(l=>l.chara_id).includes(o)){for(let l=0;l<i.length;l++)i[l].chara_id===o&&(i.splice(l,1),l--);d([...i])}else i.length<3&&(i.push(r),d([...i]))},R=()=>{let o=sessionStorage.register_id||null,i=JSON.stringify({user_id:o,chosen_chara_ids:c.map(l=>l.chara_id).toString(),chosen_world_ids:[s.world_id].toString()}),r={method:"post",url:`${$}/generate_outline`,headers:{"Content-Type":"application/json"},data:i};f(r).then(l=>{sessionStorage.setItem("outline_id",l.data.outline_id),sessionStorage.setItem("background",JSON.stringify(s)),sessionStorage.setItem("user_list",JSON.stringify(c)),sessionStorage.removeItem("outline_data"),t("/synopsis",{state:{}})}).catch(l=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})},H=o=>{o.preventDefault();let i=sessionStorage.register_id||null,r=w,l=c.map(F=>F.chara_id).toString(),B="";s&&(B=[s.world_id].toString());let v=JSON.stringify({user_id:i,search_query:r,chosen_chara_ids:l,chosen_world_ids:B});if(a==1){let F={method:"post",url:`${$}/get_chara_list`,headers:{"Content-Type":"application/json"},data:v};f(F).then(A=>{x(A.data.chara_list)}).catch(A=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}else{let F={method:"post",url:`${$}/get_world_list`,headers:{"Content-Type":"application/json"},data:v};f(F).then(A=>{T(A.data.world_list)}).catch(A=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}},W=o=>i=>{i.stopPropagation();let r=c;for(let l=0;l<r.length;l++)r[l].chara_id===o&&(r.splice(l,1),l--);d([...r])};return h("div",{className:"container",id:"character_select",children:[h("div",{className:"container-wrap",children:[h("div",{className:"common-header",children:[e("div",{className:"common-header-title01",children:"-\u4F5C\u54C1\u30EA\u30DF\u30C3\u30AF\u30B9-"}),e("div",{className:"common-header-title02",children:"\u30DE\u305C\u3066"})]}),h("div",{className:"preview",children:[h("div",{className:"preview-part",onClick:()=>{u(1),_(p),C(null)},children:[h("div",{className:"preview-img-part",children:[c.map(o=>e("div",{style:{backgroundImage:`url(${o.img_url})`},className:"avatar-preview",children:h("div",{className:"avatar-preview-close",onClick:W(o.chara_id),children:[e("span",{}),e("span",{})]})},o.chara_id)),c.length==0&&e("div",{className:"avatar-preview",style:{backgroundImage:"url(/assets/image/default-avatar.png)"}})]}),e("div",{className:a===1?"preview-title-part active":"preview-title-part",children:"\u30AD\u30E3\u30E9"})]}),h("div",{className:"preview-part",onClick:()=>{u(2),_(k),C(null)},children:[e("div",{className:"preview-img-part",children:e("div",{style:{backgroundImage:`url(${s!=null?s.img_url:"/assets/image/point-bg.png"})`},className:s!=null?"world-preview":"world-none-preview"})}),e("div",{className:a===2?"preview-title-part active":"preview-title-part",children:"\u30B7\u30C1\u30E5\u30A8\u30FC\u30B7\u30E7\u30F3"})]})]}),h("div",{className:"point-select",children:[e("div",{className:"point-search",children:h("form",{onSubmit:H,children:[e(oe,{value:w,onChange:(o,i)=>{typeof i=="string"?C({label:i}):i&&i.inputValue?C({label:i.inputValue}):C(i)},filterOptions:(o,i)=>_e(o,i),selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:E,getOptionLabel:o=>typeof o=="string"?o:o.label,renderOption:(o,i)=>e("li",K(M({},o),{children:i.label})),renderInput:o=>e(le,K(M({},o),{label:"",placeholder:ye[a-1]}))}),e("button",{className:"search-btn",children:e("img",{src:"/assets/image/point-search.png",alt:""})})]})}),e("div",{className:"point-intro",children:"\u753B\u50CF\u306FBing\u306E\u691C\u7D22\u7D50\u679C\u3092\u3082\u3068\u306B\u8868\u793A\u3057\u3066\u3044\u307E\u3059"}),h("div",{className:"point-body",style:{height:`calc(${J}px - 340px)`},children:[a===1&&e("div",{className:"point-body-wrap",children:N.map((o,i)=>e("div",{style:{backgroundImage:`url(${o.img_url})`},onClick:()=>S(o.chara_id),className:`${c.map(r=>r.chara_id).includes(o.chara_id)?"active":""} character-item`,children:e("span",{})},i))}),a==2&&e("div",{className:"point-body-wrap",children:I.map((o,i)=>e("div",{style:{backgroundImage:`url(${o.img_url})`},className:`${(s==null?void 0:s.img_url)==o.img_url?"active":""} location-item`,onClick:r=>{m(o)},children:e("span",{})},i))})]})]})]}),h("button",{onClick:R,className:`character-add-btn ${b?"active":""}`,disabled:!b,children:[e("img",{src:"/assets/image/imgpsh_fullsize_anim.png",alt:""}),"\u30DE\u305C\u308B"]})]})}const V="https://mazete-api-dev.pechakucha.ai";function Se(){const[t,a]=n.exports.useState([0,0]);return n.exports.useLayoutEffect(()=>{function u(){a([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",u),u(),()=>window.removeEventListener("resize",u)},[]),t}function Fe(){const t=U(),a=n.exports.useRef(),[u,c]=n.exports.useState(!1),[d,s]=n.exports.useState(!0),[m,b]=n.exports.useState(""),[O,N]=n.exports.useState([]),[x,I]=n.exports.useState(null),[T,k]=Se();n.exports.useEffect(()=>{let p=window.innerHeight;document.getElementById("loading_synposis").style.height=p+"px";let y=sessionStorage.register_id||null,E=sessionStorage.outline_id||null,_=sessionStorage.background||null,w=sessionStorage.user_list||null,C=sessionStorage.outline_data||null;(!w||!_)&&t("/",{state:{}}),I(JSON.parse(_)),N(JSON.parse(w));let z=JSON.stringify({user_id:y,outline_id:E});if(C)b(JSON.parse(C)),s(!1);else{let J={method:"post",url:`${V}/get_outline`,headers:{"Content-Type":"application/json"},data:z};f(J).then(S=>{S.data.generated&&S.data.outline&&!S.data.error?(s(!1),b(S.data.outline)):t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}).catch(S=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}},[]);const L=()=>{let p=sessionStorage.register_id||null,y=sessionStorage.outline_id||null;sessionStorage.setItem("outline_data",JSON.stringify(m));let E=JSON.stringify({user_id:p,outline_id:y,outline:m}),_={method:"post",url:`${V}/generate_story`,headers:{"Content-Type":"application/json"},data:E};f(_).then(w=>{t(`/talk/${w.data.story_id}`,{state:{}})}).catch(w=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})};return n.exports.useEffect(()=>{a.current&&u&&a.current.focus()},[u]),h("div",{className:"container",id:"loading_synposis",children:[h("div",{className:"container-wrap",children:[e("div",{className:`ls-top ${u?"editing":""}`,children:e("div",{className:"ls-top-wrap",style:{backgroundImage:`url(${x==null?void 0:x.img_url}`,backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center"},children:e("div",{className:"ls-top-body",children:O.map((p,y)=>e("div",{className:"ls-top-item",style:{backgroundImage:`url(${p==null?void 0:p.img_url})`}},y))})})}),h("div",{className:"ls-main",style:{height:`calc(${k}px - 280px)`},children:[e("div",{className:"ls-main-title",children:"\u307E\u3048\u304C\u304D"}),h("div",{className:"ls-main-loading-text",style:{height:"calc(100% - 70px)"},children:[d&&h("div",{className:"ls-main-loading-part",children:[e("img",{src:"/assets/image/white-loading.gif",alt:""}),e("span",{children:"\u4E0B\u66F8\u304D\u6E96\u5099\u4E2D"})]}),!d&&e("textarea",{ref:a,className:"ls-main-loading-wrap",value:m,disabled:!u,onChange:p=>{b(p.target.value)},onBlur:()=>{c(!1)}})]}),!u&&h("a",{className:"ls-main-edit-btn",onClick:()=>{a.current.focus(),c(!0)},children:[e("span",{children:"\u7DE8\u96C6"}),e("img",{src:"/assets/image/edit-icon.png",alt:""})]})]})]}),!u&&e("button",{className:"back-to-btn",onClick:()=>{let p=sessionStorage.user_list||null;t("/",{state:{user_list:p}})},children:e("img",{src:"/assets/image/back-to-img.png",alt:""})}),!u&&e("div",{className:"ls-main-making-btn-part",children:e("button",{onClick:L,className:d?"ls-main-making-btn":"ls-main-making-btn active",disabled:d,children:"\u3053\u306E\u4E16\u754C\u7DDA\u306B\u5165\u308B"})})]})}const G="https://mazete-api-dev.pechakucha.ai";function ee(t){return new Promise(a=>setTimeout(a,t))}function be(){const[t,a]=n.exports.useState([0,0]);return n.exports.useLayoutEffect(()=>{function u(){a([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",u),u(),()=>window.removeEventListener("resize",u)},[]),t}function Ee(){const t=U(),[a,u]=n.exports.useState(!0),[c,d]=n.exports.useState(null),[s,m]=n.exports.useState(0),[b,O]=n.exports.useState(null),[N,x]=n.exports.useState(null),[I,T]=n.exports.useState([]),[k,L]=n.exports.useState(!1),[p,y]=n.exports.useState(!1),[E,_]=n.exports.useState(!1),[w,C]=be();let{story_id:z}=de();n.exports.useEffect(()=>{let r=sessionStorage.register_id||null,l=JSON.stringify({user_id:r,story_id:z}),B={method:"post",url:`${G}/get_story`,headers:{"Content-Type":"application/json"},data:l};f(B).then(v=>{u(!1),v.data.generated&&!v.data.error?(u(!1),d(v.data)):t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}).catch(v=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})},[]),n.exports.useEffect(()=>{c&&J()},[c,s]),n.exports.useEffect(async()=>{if(c){let r=c.story;await ee(1),O(r[s].position)}},[N]);const J=()=>{let r=c.story;x(r[s].chara_img_url),r[s].multiple?(L(!0),T(r[s].content)):(L(!1),S(r[s].content))},S=async r=>{_(!0);for(var l=0;l<r.length;)T([r.substring(0,l+1)]),l++,await ee(75);_(!1),c.story.length-1==s&&y(!0)},R=r=>{k&&(L(!1),S(r))},H=()=>{!E&&!k&&c.story.length-1>s&&m(s+1)},W=()=>{s===0&&t("/synopsis",{state:{}}),s!=0&&!E&&(m(s-1),y(!1))},o=r=>{r.preventDefault(),sessionStorage.removeItem("outline_id"),sessionStorage.removeItem("background"),sessionStorage.removeItem("user_list"),t("/",{state:{}})},i=r=>{let l=sessionStorage.register_id||null;u(!0);let B=JSON.stringify({user_id:l,story_id:z,chosen_content:r}),v={method:"post",url:`${G}/generate_rest_story`,headers:{"Content-Type":"application/json"},data:B};f(v).then(F=>{let A=F.data.story_id,P=JSON.stringify({user_id:l,story_id:A}),q={method:"post",url:`${G}/get_rest_story`,headers:{"Content-Type":"application/json"},data:P};f(q).then(D=>{u(!1),D.data.generated&&!D.data.error?(console.log(c.story,s,c.story.length),c.story.splice(s+1,c.story.length-s-1),c.story=c.story.concat(D.data.story),d(c),R(r)):t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}).catch(D=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}).catch(F=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})};return h(Z,{children:[a&&e("div",{className:"container",id:"loading_adventure",children:e("div",{className:"container-wrap",children:h("div",{className:"la-wrap",children:[e("img",{src:"/assets/image/black-loading.gif",alt:""}),e("span",{children:"\u6E96\u5099\u4E2D"})]})})}),!a&&h("div",{className:"container",id:"adventure_state",style:{height:C},children:[h("div",{className:"container-wrap",onClick:H,children:[e("div",{className:"as-thumb",style:{backgroundImage:`url(${c==null?void 0:c.background_url})`},children:N&&e("img",{src:N,alt:"",className:`as-thumb-character ${b==0?"lb":b==1?"mb":"rb"}`})}),e("div",{className:"as-text",children:I.map((r,l)=>e("div",{className:`as-text-wrap ${E||k||p?"":"arrow"}`,style:{minHeight:`${k?"unset":"80px"}`},onClick:()=>{i(r)},children:r},l))})]}),e("button",{className:"back-to-btn",onClick:W,children:e("img",{src:s==0?"/assets/image/back-to-img.png":"/assets/image/back.png",alt:""})}),p&&e("div",{className:"text-select-btn-group",children:e("a",{onClick:o,className:"final-btn",children:"\u30C8\u30C3\u30D7\u3078"})})]})]})}function we(){const t=Y();return console.log(t),e("div",{className:"flex-center position-ref full-height full-width bg-white",children:e("div",{className:"message",style:{padding:"10px"},dangerouslySetInnerHTML:{__html:t.state.message}})})}function Ae(){return e(he,{children:h(pe,{children:[e(j,{path:"/",element:e(Ce,{})}),e(j,{path:"/synopsis",element:e(Fe,{})}),e(j,{path:"/talk/:id",element:e(Ee,{})}),e(j,{path:"/error",element:e(we,{})})]})})}function Ne(){return e(Z,{children:e(Ae,{})})}ge.render(e(me.StrictMode,{children:e(Ne,{})}),document.getElementById("root"));
