var re=Object.defineProperty,ie=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var V=(t,s,i)=>s in t?re(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,U=(t,s)=>{for(var i in s||(s={}))oe.call(s,i)&&V(t,i,s[i]);if(Z)for(var i of Z(s))le.call(s,i)&&V(t,i,s[i]);return t},K=(t,s)=>ie(t,ne(s));import{u as G,a as ee,r,v as ce,b as S,j as d,c as e,A as de,T as ge,d as he,e as pe,F as te,B as me,R as fe,f as H,g as _e,h as ve}from"./vendor.744e6562.js";const ye=function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))p(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const F of a.addedNodes)F.tagName==="LINK"&&F.rel==="modulepreload"&&p(F)}).observe(document,{childList:!0,subtree:!0});function i(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function p(o){if(o.ep)return;o.ep=!0;const a=i(o);fetch(o.href,a)}};ye();const $="https://mazete-api-dev.pechakucha.ai",Ce=he({stringify:t=>t.kana+t.label});function Fe(){const[t,s]=r.exports.useState([0,0]);return r.exports.useLayoutEffect(()=>{function i(){s([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",i),i(),()=>window.removeEventListener("resize",i)},[]),t}const Se=["\u30AD\u30E3\u30E9\u540D\u307E\u305F\u306F\u4F5C\u54C1\u540D\u3067\u3055\u304C\u3059","\u5834\u9762\u540D\u307E\u305F\u306F\u4F5C\u54C1\u540D\u3067\u3055\u304C\u3059"];function Ee(){const t=G();ee();const[s,i]=r.exports.useState(1),[p,o]=r.exports.useState([]),[a,F]=r.exports.useState(null),[g,O]=r.exports.useState(!1),[A,B]=r.exports.useState([]),[x,I]=r.exports.useState([]),[z,D]=r.exports.useState([]),[k,m]=r.exports.useState([]),[v,E]=r.exports.useState([]),[b,_]=r.exports.useState(null),[W,N]=Fe();r.exports.useEffect(()=>{let n=window.innerHeight;document.getElementById("character_select").style.height=n+"px";let u=sessionStorage.register_id||null,f=sessionStorage.background||null,l=sessionStorage.user_list||null;if(l&&o(JSON.parse(l)),f&&F(JSON.parse(f)),!u){u=ce();var c=JSON.stringify({register_id:u}),y={method:"post",url:`${$}/register_id`,headers:{"Content-Type":"application/json"},data:c};S(y).then(h=>{sessionStorage.setItem("register_id",u)}).catch(h=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}let w=JSON.stringify({user_id:u,search_query:"",chosen_chara_ids:"",chosen_world_ids:""}),C={method:"post",url:`${$}/get_chara_list`,headers:{"Content-Type":"application/json"},data:w};S(C).then(h=>{B(h.data.chara_list)}).catch(h=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})});let T=JSON.stringify({user_id:u,search_query:"",chosen_chara_ids:"",chosen_world_ids:""}),j={method:"post",url:`${$}/get_world_list`,headers:{"Content-Type":"application/json"},data:T};S(j).then(h=>{I(h.data.world_list)}).catch(h=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})});let L={method:"post",url:`${$}/get_autocomplete_chara`,headers:{"Content-Type":"application/json"},data:{}};S(L).then(h=>{m(h.data.auto_complete),E(h.data.auto_complete)}).catch(h=>{});let M={method:"post",url:`${$}/get_autocomplete_world`,headers:{"Content-Type":"application/json"},data:{}};S(M).then(h=>{D(h.data.auto_complete)}).catch(h=>{})},[]),r.exports.useEffect(()=>{a&&p.length>0?O(!0):O(!1)},[p,a]);const J=n=>{let u=p,f=A.filter(l=>l.chara_id==n)[0];if(u==null?void 0:u.map(l=>l.chara_id).includes(n)){for(let l=0;l<u.length;l++)u[l].chara_id===n&&(u.splice(l,1),l--);o([...u])}else u.length<3&&(u.push(f),o([...u]))},P=()=>{let n=sessionStorage.register_id||null,u=JSON.stringify({user_id:n,chosen_chara_ids:p.map(l=>l.chara_id).toString(),chosen_world_ids:[a.world_id].toString()}),f={method:"post",url:`${$}/generate_outline`,headers:{"Content-Type":"application/json"},data:u};S(f).then(l=>{sessionStorage.setItem("outline_id",l.data.outline_id),sessionStorage.setItem("background",JSON.stringify(a)),sessionStorage.setItem("user_list",JSON.stringify(p)),sessionStorage.removeItem("outline_data"),t("/synopsis",{state:{}})}).catch(l=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})},R=n=>{n.preventDefault();let u=sessionStorage.register_id||null,f=b,l=p.map(w=>w.chara_id).toString(),c="";a&&(c=[a.world_id].toString());let y=JSON.stringify({user_id:u,search_query:f,chosen_chara_ids:l,chosen_world_ids:c});if(s==1){let w={method:"post",url:`${$}/get_chara_list`,headers:{"Content-Type":"application/json"},data:y};S(w).then(C=>{B(C.data.chara_list)}).catch(C=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}else{let w={method:"post",url:`${$}/get_world_list`,headers:{"Content-Type":"application/json"},data:y};S(w).then(C=>{I(C.data.world_list)}).catch(C=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}},q=n=>u=>{u.stopPropagation();let f=p;for(let l=0;l<f.length;l++)f[l].chara_id===n&&(f.splice(l,1),l--);o([...f])};return d("div",{className:"container",id:"character_select",children:[d("div",{className:"container-wrap",children:[d("div",{className:"common-header",children:[e("div",{className:"common-header-title01",children:"-\u4F5C\u54C1\u30EA\u30DF\u30C3\u30AF\u30B9-"}),e("div",{className:"common-header-title02",children:"\u30DE\u305C\u3066"})]}),d("div",{className:"preview",children:[d("div",{className:"preview-part",onClick:()=>{i(1),E(k),_(null)},children:[d("div",{className:"preview-img-part",children:[p==null?void 0:p.map(n=>e("div",{style:{backgroundImage:`url(${n.img_url})`},className:"avatar-preview",children:d("div",{className:"avatar-preview-close",onClick:q(n.chara_id),children:[e("span",{}),e("span",{})]})},n.chara_id)),p.length==0&&e("div",{className:"avatar-preview",style:{backgroundImage:"url(/assets/image/default-avatar.png)"}})]}),e("div",{className:s===1?"preview-title-part active":"preview-title-part",children:"\u30AD\u30E3\u30E9"})]}),d("div",{className:"preview-part",onClick:()=>{i(2),E(z),_(null)},children:[e("div",{className:"preview-img-part",children:e("div",{style:{backgroundImage:`url(${a!=null?a.img_url:"/assets/image/point-bg.png"})`},className:a!=null?"world-preview":"world-none-preview"})}),e("div",{className:s===2?"preview-title-part active":"preview-title-part",children:"\u30B7\u30C1\u30E5\u30A8\u30FC\u30B7\u30E7\u30F3"})]})]}),d("div",{className:"point-select",children:[e("div",{className:"point-search",children:d("form",{onSubmit:R,children:[e(de,{value:b,onChange:(n,u)=>{typeof u=="string"?_(u):u&&u.inputValue?_(u.inputValue):u&&u.label?_(u.label):_(u)},filterOptions:(n,u)=>Ce(n,u),selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:v,getOptionLabel:n=>typeof n=="string"?n:n.label,renderOption:(n,u)=>e("li",K(U({},n),{children:u.label})),renderInput:n=>e(ge,K(U({},n),{label:"",placeholder:Se[s-1],onChange:u=>{_(u.target.value)}}))}),e("button",{className:"search-btn",children:e("img",{src:"/assets/image/point-search.png",alt:""})})]})}),e("div",{className:"point-intro",children:"\u753B\u50CF\u306FBing\u306E\u691C\u7D22\u7D50\u679C\u3092\u3082\u3068\u306B\u8868\u793A\u3057\u3066\u3044\u307E\u3059"}),d("div",{className:"point-body",style:{height:`calc(${N}px - 305px)`},children:[s===1&&e("div",{className:"point-body-wrap",children:A==null?void 0:A.map((n,u)=>e("div",{style:{backgroundImage:`url(${n.img_url})`},onClick:()=>J(n.chara_id),className:`${p.map(f=>f.chara_id).includes(n.chara_id)?"active":""} character-item`,children:e("span",{})},u))}),s==2&&e("div",{className:"point-body-wrap",children:x==null?void 0:x.map((n,u)=>e("div",{style:{backgroundImage:`url(${n.img_url})`},className:`${(a==null?void 0:a.img_url)==n.img_url?"active":""} location-item`,onClick:f=>{F(n)},children:e("span",{})},u))})]})]})]}),d("button",{onClick:P,className:`character-add-btn ${g?"active":""}`,disabled:!g,children:[e("img",{src:"/assets/image/imgpsh_fullsize_anim.png",alt:""}),"\u30DE\u305C\u308B"]})]})}const Q="https://mazete-api-dev.pechakucha.ai";function be(){const[t,s]=r.exports.useState([0,0]);return r.exports.useLayoutEffect(()=>{function i(){s([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",i),i(),()=>window.removeEventListener("resize",i)},[]),t}function we(){const t=G(),s=r.exports.useRef(),[i,p]=r.exports.useState(!1),[o,a]=r.exports.useState(!0),[F,g]=r.exports.useState(""),[O,A]=r.exports.useState([]),[B,x]=r.exports.useState(null),[I,z]=r.exports.useState(10);be(),r.exports.useEffect(()=>{var v;let m=((v=s==null?void 0:s.current)==null?void 0:v.scrollHeight)+"px";z(m)},[F]),r.exports.useEffect(()=>{let m=window.innerHeight;document.getElementById("loading_synposis").style.height=m+"px";let v=sessionStorage.register_id||null,E=sessionStorage.outline_id||null,b=sessionStorage.background||null;x(JSON.parse(b));let _=JSON.stringify({user_id:v,outline_id:E}),W={method:"post",url:`${Q}/get_outline`,headers:{"Content-Type":"application/json"},data:_};S(W).then(N=>{N.data.generated&&N.data.outline&&!N.data.error?(a(!1),A(N.data.chara_img_urls),g(N.data.outline)):t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}).catch(N=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})},[]);const D=()=>{let m=sessionStorage.register_id||null,v=sessionStorage.outline_id||null;sessionStorage.setItem("outline_data",JSON.stringify(F));let E=JSON.stringify({user_id:m,outline_id:v}),b={method:"post",url:`${Q}/generate_story`,headers:{"Content-Type":"application/json"},data:E};S(b).then(_=>{t(`/talk/${_.data.story_id}`,{state:{}})}).catch(_=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})};r.exports.useEffect(()=>{s.current&&i&&s.current.focus()},[i]);const k=()=>{p(!1);let m=sessionStorage.register_id||null,v=sessionStorage.outline_id||null,E=JSON.stringify({user_id:m,outline_id:v,outline:F}),b={method:"post",url:`${Q}/update_outline`,headers:{"Content-Type":"application/json"},data:E};S(b).then(_=>{A(_.data.new_chara_img_urls)}).catch(_=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})};return d("div",{className:"container",id:"loading_synposis",children:[d("div",{className:"container-wrap",children:[e("div",{className:`ls-top ${i?"editing":""}`,children:e("div",{className:"ls-top-wrap",style:{backgroundImage:`url(${B==null?void 0:B.img_url}`,backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center"},children:e("div",{className:"ls-top-body",children:O.map((m,v)=>e("div",{className:"ls-top-item",style:{backgroundImage:`url(${m})`}},v))})})}),d("div",{className:"ls-main",children:[e("div",{className:"ls-main-title",children:"\u307E\u3048\u304C\u304D"}),d("div",{className:"ls-main-loading-text",children:[o&&d("div",{className:"ls-main-loading-part",children:[e("img",{src:"/assets/image/white-loading.gif",alt:""}),e("span",{children:"\u4E0B\u66F8\u304D\u6E96\u5099\u4E2D"})]}),!o&&e("textarea",{style:{height:I},ref:s,className:"ls-main-loading-wrap",value:F,disabled:!i,onChange:m=>{g(m.target.value)},onBlur:k})]}),!i&&d("a",{className:"ls-main-edit-btn",onClick:()=>{s.current.focus(),p(!0)},children:[e("span",{children:"\u7DE8\u96C6"}),e("img",{src:"/assets/image/edit-icon.png",alt:""})]}),!i&&e("div",{className:"ls-main-making-btn-part",children:e("button",{onClick:D,className:o?"ls-main-making-btn":"ls-main-making-btn active",disabled:o,children:"\u3053\u306E\u4E16\u754C\u7DDA\u306B\u5165\u308B"})})]})]}),!i&&e("button",{className:"back-to-btn",onClick:()=>{let m=sessionStorage.user_list||null;t("/",{state:{user_list:m}})},children:e("img",{src:"/assets/image/back-to-img.png",alt:""})})]})}const X="https://mazete-api-dev.pechakucha.ai";function ue(t){return new Promise(s=>setTimeout(s,t))}function Ae(){const[t,s]=r.exports.useState([0,0]);return r.exports.useLayoutEffect(()=>{function i(){s([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",i),i(),()=>window.removeEventListener("resize",i)},[]),t}function Ne(){const t=G(),[s,i]=r.exports.useState(!0),[p,o]=r.exports.useState(!0),[a,F]=r.exports.useState(null),[g,O]=r.exports.useState(0),[A,B]=r.exports.useState(null),[x,I]=r.exports.useState(null),[z,D]=r.exports.useState([]),[k,m]=r.exports.useState(!1),[v,E]=r.exports.useState(!1),[b,_]=r.exports.useState(!1),[W,N]=Ae();let{id:J}=pe();r.exports.useEffect(()=>{let c=sessionStorage.register_id||null,y=JSON.stringify({user_id:c,story_id:J}),w={method:"post",url:`${X}/get_story`,headers:{"Content-Type":"application/json"},data:y};S(w).then(C=>{if(C.data.generated&&!C.data.error){F(C.data);let T=C.data.story.map(j=>{const L=new Image;return L.src=j.chara_img_url,L});o(T),i(!1)}else t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}).catch(C=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})},[]),r.exports.useEffect(()=>{a&&P()},[a,g]),r.exports.useEffect(async()=>{if(a){let c=a.story;await ue(1),B(c[g].position)}},[x]);const P=()=>{let c=a.story;I(c[g].chara_img_url),c[g].multiple?(m(!0),D(c[g].content)):(m(!1),R(c[g].content))},R=async c=>{_(!0);for(var y=0;y<c.length;)D([c.substring(0,y+1)]),y++,await ue(75);_(!1),a.story.length-1==g&&E(!0)},q=c=>{k&&(m(!1),R(c))},n=()=>{!b&&!k&&a.story.length-1>g&&O(g+1)},u=()=>{g===0&&t("/synopsis",{state:{}}),g!=0&&!b&&(O(g-1),E(!1))},f=c=>{c.preventDefault(),sessionStorage.removeItem("outline_id"),sessionStorage.removeItem("background"),sessionStorage.removeItem("user_list"),t("/",{state:{}})},l=c=>{if(!k)return;let y=sessionStorage.register_id||null;i(!0);let w=JSON.stringify({user_id:y,story_id:J,chosen_content:c}),C={method:"post",url:`${X}/generate_rest_story`,headers:{"Content-Type":"application/json"},data:w};S(C).then(T=>{let j=T.data.story_id,L=JSON.stringify({user_id:y,story_id:j}),M={method:"post",url:`${X}/get_rest_story`,headers:{"Content-Type":"application/json"},data:L};S(M).then(h=>{if(h.data.generated&&!h.data.error){a.story.splice(g+1,a.story.length-g-1),a.story=a.story.concat(h.data.story),F(a),q(c);let se=h.data.story.map(ae=>{const Y=new Image;return Y.src=ae.chara_img_url,Y});o(se),i(!1)}else t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}).catch(h=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}).catch(T=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})};return d(te,{children:[s&&e("div",{className:"container",id:"loading_adventure",children:e("div",{className:"container-wrap",children:d("div",{className:"la-wrap",children:[e("img",{src:"/assets/image/black-loading.gif",alt:""}),e("span",{children:"\u6E96\u5099\u4E2D"})]})})}),!s&&d("div",{className:"container",id:"adventure_state",style:{height:N},children:[d("div",{className:"container-wrap",onClick:n,children:[e("div",{className:"as-thumb",style:{backgroundImage:`url(${a==null?void 0:a.background_url})`},children:x&&e("img",{src:x,alt:"",className:`as-thumb-character ${A==0?"lb":A==1?"mb":"rb"}`})}),e("div",{className:"as-text",children:z.map((c,y)=>e("div",{className:`as-text-wrap ${b||k||v?"":"arrow"}`,style:{minHeight:`${k?"unset":"80px"}`},onClick:()=>{l(c)},children:c},y))})]}),e("button",{className:"back-to-btn",onClick:u,children:e("img",{src:g==0?"/assets/image/back-to-img.png":"/assets/image/back.png",alt:""})}),v&&e("div",{className:"text-select-btn-group",children:e("a",{onClick:f,className:"final-btn",children:"\u30C8\u30C3\u30D7\u3078"})})]})]})}function xe(){const t=ee();return console.log(t),e("div",{className:"flex-center position-ref full-height full-width bg-white",children:e("div",{className:"message",style:{padding:"10px"},dangerouslySetInnerHTML:{__html:t.state.message}})})}function ke(){return e(me,{children:d(fe,{children:[e(H,{path:"/",element:e(Ee,{})}),e(H,{path:"/synopsis",element:e(we,{})}),e(H,{path:"/talk/:id",element:e(Ne,{})}),e(H,{path:"/error",element:e(xe,{})})]})})}function Be(){return e(te,{children:e(ke,{})})}_e.render(e(ve.StrictMode,{children:e(Be,{})}),document.getElementById("root"));
